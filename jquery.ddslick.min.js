(function(d){d.fn.ddslick=function(l){if(b[l]){return b[l].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof l==="object"||!l){return b.init.apply(this,arguments)}else{d.error("Method "+l+" does not exists.")}}};var b={},c={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,onSelected:function(){},defaultTarget:"_blank",resetmenu:false,enableKeyboard:true,keyboard:[{up:38,down:40,select:13}]},k=null,h='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',a='<ul class="dd-options"></ul>';b.init=function(l){var m=l;return this.each(function(){var C=d.extend({},c,m);var v=d(this),w=v.data("ddslick"),o=v.attr("name");if(!w){var q=[],r=C.data;v.find("option").each(function(){var E=d(this),D=E.data();if(E.attr("data-href")&&!E.attr("data-target")){E.attr("data-target",C.defaultTarget)}q.push({text:d.trim(E.text()),value:E.val(),selected:E.is(":selected"),description:D.description,imageSrc:D.imagesrc,href:E.attr("data-href"),target:E.attr("data-target")})});if(C.keepJSONItemsOnTop){d.merge(C.data,q)}else{C.data=d.merge(q,C.data)}var p=v,y=d("<div></div>");var z=p[0].attributes;for(var u=0;u<z.length;u++){y.attr(z[u].nodeName,z[u].nodeValue)}v.replaceWith(y);v=y;v.addClass("dd-container").append(h).append(a);d("input",v).attr("name",o);var q=v.find(".dd-select"),B=v.find(".dd-options");B.css({width:C.width});q.css({width:C.width});v.css({width:C.width});if(C.height!=null){B.css({height:C.height,overflow:"auto"})}d.each(C.data,function(D,E){B.append("<li><a "+(E.href===undefined?"":'href="'+E.href+'" target="'+E.target+'"')+' class="dd-option">'+(E.value?' <input class="dd-option-value" type="hidden" value="'+E.value+'" />':"")+(E.imageSrc?' <img class="dd-option-image'+(C.imagePosition=="right"?" dd-image-right":"")+'" src="'+E.imageSrc+'" />':"")+(E.text?' <label tabIndex=0 class="dd-option-text" style="cursor:pointer;">'+E.text+"</label>":"")+(E.description?' <small class="dd-option-description dd-desc">'+E.description+"</small>":"")+"</a></li>")});var A={settings:C,original:p,selectedIndex:-1,selectedItem:null,selectedData:null};v.data("ddslick",A);if(C.selectText.length>0&&C.defaultSelectedIndex==null){v.find(".dd-selected").html(C.selectText)}else{var x=(C.defaultSelectedIndex!=null&&C.defaultSelectedIndex>=0&&C.defaultSelectedIndex<C.data.length)?C.defaultSelectedIndex:0;i(v,x)}var n=B.parent().find(".dd-selected-value").val(),t=B.find("li").size()-2;var s=false;v.find(".dd-select").bind("keypress",function(H){var D=H.keyCode||H.which;if(D==13){var G=document.activeElement;if(G&&!G.id){var F=String.fromCharCode(65+Math.floor(Math.random()*26));var E=F+Date.now();G.id=E}k=G.id;n=v.find(".dd-option-selected").parent().index();t=v.find("ul").find("li").size()-2;e(v);s=true}});v.find(".dd-select").click(function(){var F=document.activeElement;if(F&&!F.id){var E=String.fromCharCode(65+Math.floor(Math.random()*26));var D=E+Date.now();F.id=D}k=F.id;n=v.find(".dd-option-selected").parent().index();t=v.find("ul").find("li").size()-2;e(v);s=true});v.find(".dd-option").click(function(){i(v,d(this).closest("li").index());s=false});if(C.clickOffToClose&&!v.attr("multiple")){B.addClass("dd-click-off-close");v.click(function(D){D.stopPropagation()});d("body").click(function(){d(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up");s=false})}d(document).keydown(function(D){if(s==true&&C.enableKeyboard==true){if(D.keyCode==C.keyboard[0].down){B.find("li").eq(n).find("a").removeClass("dd-option-hover");n<=t?n++:n=0;B.find("li").eq(n).find("a").addClass("dd-option-hover")}else{if(D.keyCode==C.keyboard[0].up){B.find("li").eq(n).find("a").removeClass("dd-option-hover");n>=0?n--:n=t;B.find("li").eq(n).find("a").addClass("dd-option-hover")}else{if(D.keyCode==C.keyboard[0].select){i(v,B.find("li").eq(n).index());if(B.find("li").eq(n).find("a").attr("href")){window.open(B.find("li").eq(n).find("a").attr("href"),B.find("li").eq(n).find("a").attr("target"))}s=false}}}return false}else{return true}console.log(D.keyCode)});B.find("li").bind("mouseover",function(){d(this).parent().find(".dd-option-hover").removeClass("dd-option-hover");n=d(this).index()});if(v.attr("multiple")){v.find(".dd-selected").css({display:"none"});v.find(".dd-options").css({display:"block",position:"relative",zIndex:"1"})}}})};b.selectedData=function(){var o=d(this),n=o.find(".dd-options").find("li").find(".dd-option-selected"),m=[],l=null;n.each(function(p){m.push({text:d(this).find(".dd-option-text").text(),value:d(this).find("input").val(),description:d(this).find(".dd-option-description").text(),imageSrc:d(this).find(".dd-option-image").attr("src"),href:d(this).attr("href"),target:d(this).attr("target")})});return m};b.disable=function(){return this.each(function(){var l=d(this);l.addClass("dd-disabled")})};b.enable=function(){return this.each(function(){var l=d(this);if(l.hasClass("dd-disabled")){l.removeClass("dd-disabled")}})};b.select=function(l){return this.each(function(){if(l.index!=null){i(d(this),l.index)}})};b.open=function(){return this.each(function(){var m=d(this),l=m.data("ddslick");if(l){e(m)}})};b.close=function(){return this.each(function(){var m=d(this),l=m.data("ddslick");if(l){j(m)}})};b.destroy=function(){return this.each(function(){var n=d(this),m=n.data("ddslick");if(m){var l=m.original;n.removeData("ddslick").unbind(".ddslick").replaceWith(l)}})};function i(q,s){var u=q.data("ddslick");var r=q.find(".dd-selected"),n=r.siblings(".dd-selected-value"),v=q.find(".dd-options"),l=r.siblings(".dd-pointer"),p=q.find(".dd-option").eq(s),m=p.closest("li"),o=u.settings,t=u.settings.data[s];if(!q.attr("multiple")){q.find(".dd-option").removeClass("dd-option-selected");p.addClass("dd-option-selected")}else{if(q.find(".dd-option").eq(s).hasClass("dd-option-selected")){q.find(".dd-option").eq(s).removeClass("dd-option-selected")}else{p.addClass("dd-option-selected")}}u.selectedIndex=s;u.selectedItem=m;u.selectedData=t;if(typeof o.onSelected=="function"&&r.text().length>0){o.onSelected.call(this,u)}if(r.text().length==0||!o.resetmenu){if(o.showSelectedHTML){r.html((t.imageSrc?'<img class="dd-selected-image'+(o.imagePosition=="right"?" dd-image-right":"")+'" src="'+t.imageSrc+'" />':"")+(t.text?'<label tabIndex=0 class="dd-selected-text" style="cursor:pointer;">'+t.text+"</label>":"")+(t.description?'<small class="dd-selected-description dd-desc'+(o.truncateDescription?" dd-selected-description-truncated":"")+'" >'+t.description+"</small>":""))}else{r.html(t.text)}}n.val(t.value);u.original.val(t.value);q.data("ddslick",u);if(k){d("#"+k).focus()}j(q);f(q)}function e(p){if(!p.hasClass("dd-disabled")){p.find("ul li a");var o=p.find(".dd-select"),m=o.siblings(".dd-options"),l=o.find(".dd-pointer"),n=m.is(":visible");d(".dd-click-off-close").not(m).slideUp(50);d(".dd-pointer").removeClass("dd-pointer-up");m.find("a").each(function(){d(this).removeClass("dd-option-hover")});if(n){m.slideUp("fast");l.removeClass("dd-pointer-up")}else{m.slideDown("fast");l.addClass("dd-pointer-up")}g(p)}}function j(l){if(!l.attr("multiple")){l.find(".dd-options").slideUp(50);l.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}}function f(o){var n=o.find(".dd-select").css("height");var m=o.find(".dd-selected-description");var l=o.find(".dd-selected-image");if(m.length<=0&&l.length>0){o.find(".dd-selected-text").css("lineHeight",n)}}function g(l){l.find(".dd-option").each(function(){var p=d(this);var n=p.css("height");var o=p.find(".dd-option-description");var m=l.find(".dd-option-image");if(o.length<=0&&m.length>0){p.find(".dd-option-text").css("lineHeight",n)}})}})(jQuery);